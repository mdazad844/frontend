<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login</title>
    <style>
        /* ... keep your existing styles ... */
    </style>
</head>
<body>
    <div class="login-box">
        <div class="brand">MyBrand</div>
        <div class="subtitle">Admin Dashboard</div>
        
        <h2>üîê Admin Login</h2>
        <input type="text" id="username" placeholder="Username" autocomplete="username">
        <input type="password" id="password" placeholder="Password" autocomplete="current-password">
        <button onclick="loginAdmin()">Login</button>
        <p id="errorMsg"></p>
        
        <div class="forgot">
            <a href="index.html">Back to Store</a>
        </div>
    </div>
    
    <script>
        const BACKEND_URL = 'https://backend-production-c281a.up.railway.app';
        
        // Check if already logged in
        if (localStorage.getItem('adminToken')) {
            // Validate token
            validateToken();
        }
        
        async function loginAdmin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMsg');
            
            errorMsg.style.display = 'none';
            
            if (!username || !password) {
                showError('Please enter username and password');
                return;
            }
            
            const btn = document.querySelector('button');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'Logging in...';
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Store token and admin info
                    localStorage.setItem('adminToken', data.token);
                    localStorage.setItem('adminInfo', JSON.stringify(data.admin));
                    localStorage.setItem('adminLoginTime', new Date().toISOString());
                    
                    // Redirect to orders dashboard
                    window.location.href = 'admin-orders.html';
                    
                } else {
                    showError(data.message || 'Login failed');
                }
                
            } catch (error) {
                console.error('Login error:', error);
                showError('Network error. Please try again.');
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }
        
        async function validateToken() {
            const token = localStorage.getItem('adminToken');
            
            if (!token) return false;
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/admin/validate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    window.location.href = 'admin-orders.html';
                }
                
            } catch (error) {
                console.log('Token validation failed');
            }
        }
        
        function showError(message) {
            const errorMsg = document.getElementById('errorMsg');
            errorMsg.textContent = message;
            errorMsg.style.display = 'block';
        }
        
        // Allow Enter key to login
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loginAdmin();
            }
        });
        
        // Auto-focus on username field
        document.getElementById('username').focus();
    </script>
</body>
</html>
